# Roguelike

Введение
==============
Данный документ описывает архитектуру консольной Roguelike игры, цель которой заключается в достижении максимально высокого уровня.

Общие сведения о системе
=========================
Игровой мир представляет собой прямоугольное поле, состоящее из символов. Каждый символ может обозначать свободное пространство, стену, персонажа или предмет. Цель игры состоит в достижении максимального уровня, который повышается в ходе битв с другими персонажами. Игра является консольной и рассчитана на одного пользователя.

Architectural Drivers
=====================
Технические ограничения
-----------------------
Игра должна запускаться на операционных системах Windows, Linux и MacOS

Качественные характеристики системы
--------------------------------
1. Обработка пользовательского ввода должна занимать не более 30 мс
2. Должна существовать возможность добавлять в дальнейшем новые виды предметов, противников, инвентаря.

Функциональные требования
---------------------------
1. Наличие персонажа игрока
2. Возможность управлять игроком с помощью клавиатуры
3. Наличие у игрока характеристик здоровья и силы атаки
4. Наличие нескольких видов инвентаря, влияющего на характеристики персонажа
5. Возможность снять/одеть инвентарь
6. Наличие нескольких видов неигровых персонажей, имеющих различное поведение
7. Игровой мир должен представлять собой карту, по которой можно перемещаться
8. Карта должна генерироваться случайным образом
9. Возможность сохранять карту в файл
10. Возможность загружать карту из файла
11. Возможность сражения с другими персонажами

Описание типичного пользователя
==================
Иван - студент первого неклассического университета - Университета ИТМО. На часах пять утра, и Иван как раз закончил делать очередное домашнее задание. Самое время немного расслабиться! После трудной работы Иван не чувствует себя достаточно бодрым, и почти любая интерактивная игра не оставит ему шансов. Но на этот случай у Ивана припасён Roguelike. Иван открывает игру, задаёт размер поля, и его взору открывается причудливое подземелье с обширными залами и небольшими закоулками. Иван начинает обходить подземелье, собирая попадающиеся по дороге предметы, как вдруг замечает что-то неладное. Его персонаж перестаёт подчиняться командам, а вместо того, чтобы двигаться прямо, отворачивает в стороны и топчется на месте. Это подействовало заклинание - догадался Иван. А тут ещё и опасный противник подбирается всё ближе. Теперь Ивану предстоит применить свои аналитические возможности, чтобы уйти от столкновения или хотя бы не оказаться запертым в углу подземелья, если оно окажется неизбежным. Пошаговая игра позволяет трезво оценить каждое действие, она непредсказуема и требует просчёта всех возможных вариантов развития событий. В особенно сложных ситуациях можно воспользоваться собранными ранее предметами, просмотрев содержимое рюкзака и выбрав наиболее подходящие. Обходя подземелье, Иван постепенно повышает уровень своего персонажа, пока не решает-таки отправиться спать - состояние этой игры он сохраняет, чтобы назавтра продолжить путешествие по закоулкам подземелья.

Доступные действия
-----------------
Основной целью пользователя во взаимодействии с системой является игра. Ему доступны следующие действия:
1. Запустить новую игру
2. Открыть сохранённую игру
3. Сохранить текущую игру

![Диаграмма вариантов использования](/diagrams/Use%20cases.png)

Архитектура системы
=====================
Состояния
----------
Переход системы по состояниям осуществляется по нажатию кнопок пользователем. В начале пользователю показывается меню с предложением выбрать способ генерации карты. После генерации, система попадает в состояние "Карта", в котором находится большую часть времени своей работы. В этом состоянии пользователь видит игровое поле и может перемещать по нему своего персонажа. Также, оставаясь на карте, можно одеть или снять дополнительные предметы. По команде пользователя происходит переход в режим отображения содержимого рюкзака и обратно на карту. В случае поражения игрока происходит визуализация результата игры (состояние "Результат"),  после чего выход из системы. Также выйти из системы можно по команде пользователя с сохранением или без сохранения состояния игры.

![Диаграмма состояний](/diagrams/States.png)
Диаграмма последовательностей
------------------------------
Ввод с клавиатуры обрабатывается объектом IOHandler, который генерирует по нему команду. В случае команды перемещения объект Environment опрашивает всех персонажей, куда они хотят перейти, и разрешает конфликты, если несколько хотят перейти в одну ячейку, организуя битву между ними. Если в битве погибает персонаж пользователя, возвращается код окончания игры в IOHandler. Иначе, IOHandler отрисовывает новое состояние окна.

![Диаграмма состояний](/diagrams/Sequences.png)
